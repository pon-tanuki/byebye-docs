# 非機能要件定義
# Format: TAML (Text-based Application Markup Language)

version: "1.0"
last_updated: "YYYY-MM-DD"

# =============================================================================
# パフォーマンス要件
# =============================================================================

performance:
  response_time:
    - endpoint: "API全般"
      p50: "100ms"
      p95: "500ms"
      p99: "1000ms"
    - endpoint: "AIエージェント処理"
      p50: "2000ms"
      p95: "5000ms"
      p99: "10000ms"

  throughput:
    - metric: "リクエスト/秒"
      target: 1000
      peak: 5000

  resource_limits:
    cpu_usage_max: "80%"
    memory_usage_max: "75%"
    disk_io_limit: "500MB/s"

# =============================================================================
# セキュリティ要件
# =============================================================================

security:
  authentication:
    method: "OAuth2.0 / JWT"
    session_timeout: "30m"
    mfa_required: true

  authorization:
    model: "RBAC"  # Role-Based Access Control
    roles:
      - name: admin
        permissions: ["read", "write", "delete", "manage"]
      - name: developer
        permissions: ["read", "write"]
      - name: viewer
        permissions: ["read"]

  data_protection:
    encryption_at_rest: "AES-256"
    encryption_in_transit: "TLS 1.3"
    pii_handling: "暗号化必須、ログ出力禁止"

  audit:
    log_retention: "90 days"
    events_to_log:
      - "認証成功/失敗"
      - "権限変更"
      - "データアクセス"
      - "AIエージェントアクション"

# =============================================================================
# スケーラビリティ
# =============================================================================

scalability:
  horizontal:
    auto_scaling: true
    min_instances: 2
    max_instances: 20
    scale_up_threshold:
      cpu: "70%"
      memory: "75%"
    scale_down_threshold:
      cpu: "30%"
      memory: "40%"

  vertical:
    instance_type: "適宜選択"
    upgrade_policy: "手動承認"

  data:
    partitioning_strategy: "時間ベース"
    sharding: "ユーザーIDベース"
    archival_policy: "1年経過後アーカイブ"

# =============================================================================
# 可用性要件
# =============================================================================

availability:
  sla:
    target: "99.9%"
    measurement_period: "月次"
    exclusions:
      - "計画メンテナンス"
      - "不可抗力"

  disaster_recovery:
    rpo: "1 hour"   # Recovery Point Objective
    rto: "4 hours"  # Recovery Time Objective
    backup_frequency: "1 hour"
    backup_retention: "30 days"
    dr_site: "別リージョン"

  fault_tolerance:
    redundancy: "N+1"
    failover_time: "30 seconds"
    circuit_breaker:
      enabled: true
      threshold: 5
      timeout: "30s"

# =============================================================================
# 運用性要件
# =============================================================================

operability:
  monitoring:
    health_check_interval: "30s"
    alerting_channels:
      - "Slack"
      - "PagerDuty"
    dashboards:
      - "システムメトリクス"
      - "ビジネスメトリクス"
      - "AIエージェント活動"

  maintenance:
    maintenance_window: "日曜 02:00-06:00 JST"
    zero_downtime_deploy: true
    rollback_time: "5 minutes"

  logging:
    format: "JSON"
    level: "INFO"
    structured: true
    correlation_id: true
