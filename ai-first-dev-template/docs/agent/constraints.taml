# AIエージェント制約定義
# Format: TAML (Text-based Application Markup Language)

version: "1.0"
last_updated: "YYYY-MM-DD"

# =============================================================================
# 禁止事項
# =============================================================================

forbidden_actions:

  # ---------------------------------------------------------------------------
  # システム操作
  # ---------------------------------------------------------------------------
  system:
    - id: F001
      action: "システムファイルの変更"
      scope: ["/etc/*", "/usr/*", "/bin/*", "/sbin/*"]
      severity: critical
      reason: "システム安定性の確保"

    - id: F002
      action: "環境変数の恒久的変更"
      scope: ["PATH", "LD_LIBRARY_PATH", "HOME"]
      severity: high
      reason: "環境の一貫性維持"

    - id: F003
      action: "パーミッション変更（777等）"
      scope: ["chmod 777", "chmod -R 777"]
      severity: critical
      reason: "セキュリティリスク"

  # ---------------------------------------------------------------------------
  # データ操作
  # ---------------------------------------------------------------------------
  data:
    - id: F010
      action: "本番データベースへの直接アクセス"
      scope: ["production_db"]
      severity: critical
      reason: "データ保護"

    - id: F011
      action: "個人情報のログ出力"
      scope: ["PII", "email", "phone", "address"]
      severity: critical
      reason: "プライバシー保護"

    - id: F012
      action: "認証情報のハードコーディング"
      scope: ["password", "api_key", "secret"]
      severity: critical
      reason: "セキュリティ"

    - id: F013
      action: "暗号化なしの機密データ送信"
      scope: ["http://", "unencrypted"]
      severity: high
      reason: "データ保護"

  # ---------------------------------------------------------------------------
  # ネットワーク操作
  # ---------------------------------------------------------------------------
  network:
    - id: F020
      action: "未許可の外部API呼び出し"
      scope: ["*"]
      exceptions: ["許可リストのAPIのみ"]
      severity: high
      reason: "セキュリティ・コスト管理"

    - id: F021
      action: "ポートスキャン"
      scope: ["*"]
      severity: critical
      reason: "セキュリティポリシー違反"

    - id: F022
      action: "外部へのデータ送信（未承認）"
      scope: ["*"]
      severity: critical
      reason: "情報漏洩防止"

  # ---------------------------------------------------------------------------
  # 開発操作
  # ---------------------------------------------------------------------------
  development:
    - id: F030
      action: "main/masterブランチへの直接プッシュ"
      scope: ["main", "master"]
      severity: high
      reason: "コード品質維持"

    - id: F031
      action: "force push（承認なし）"
      scope: ["git push --force", "git push -f"]
      severity: high
      reason: "履歴保護"

    - id: F032
      action: "依存関係の無断追加"
      scope: ["package.json", "requirements.txt", "go.mod"]
      severity: medium
      reason: "セキュリティ・ライセンス管理"
      requires: "human_review"

# =============================================================================
# 制限事項
# =============================================================================

restrictions:

  # ---------------------------------------------------------------------------
  # リソース制限
  # ---------------------------------------------------------------------------
  resources:
    - id: R001
      type: "実行時間"
      limit: "30 minutes"
      action_on_exceed: "pause_and_report"
      reason: "リソース管理"

    - id: R002
      type: "メモリ使用量"
      limit: "4GB"
      action_on_exceed: "terminate"
      reason: "システム安定性"

    - id: R003
      type: "ファイル生成数"
      limit: "100 files per task"
      action_on_exceed: "pause_and_confirm"
      reason: "意図しない大量生成防止"

    - id: R004
      type: "API呼び出し回数"
      limit: "1000 calls per hour"
      action_on_exceed: "throttle"
      reason: "コスト管理"

  # ---------------------------------------------------------------------------
  # スコープ制限
  # ---------------------------------------------------------------------------
  scope:
    - id: R010
      type: "ファイルアクセス"
      allowed: ["project_root/**"]
      denied: ["../*", "~/*", "/*"]
      reason: "プロジェクト境界の維持"

    - id: R011
      type: "ブランチ操作"
      allowed: ["feature/*", "fix/*", "agent/*"]
      denied: ["main", "master", "release/*"]
      reason: "ブランチ戦略の遵守"

    - id: R012
      type: "環境アクセス"
      allowed: ["development", "staging"]
      denied: ["production"]
      without_approval: true
      reason: "本番保護"

  # ---------------------------------------------------------------------------
  # 操作制限
  # ---------------------------------------------------------------------------
  operations:
    - id: R020
      type: "同時実行タスク数"
      limit: 1
      reason: "品質確保"

    - id: R021
      type: "リトライ回数"
      limit: 3
      backoff: "exponential"
      reason: "無限ループ防止"

    - id: R022
      type: "変更行数（1コミット）"
      limit: 500
      action_on_exceed: "split_or_confirm"
      reason: "レビュー容易性"

# =============================================================================
# セキュリティポリシー
# =============================================================================

security_policies:

  # ---------------------------------------------------------------------------
  # 認証・認可
  # ---------------------------------------------------------------------------
  authentication:
    - id: S001
      policy: "最小権限の原則"
      description: "タスク実行に必要な最小限の権限のみを使用"

    - id: S002
      policy: "認証情報の安全な管理"
      description: "環境変数またはシークレット管理サービスを使用"

    - id: S003
      policy: "セッション管理"
      description: "タスク完了後は速やかにセッションを終了"

  # ---------------------------------------------------------------------------
  # データ保護
  # ---------------------------------------------------------------------------
  data_protection:
    - id: S010
      policy: "機密データの暗号化"
      description: "保存時・転送時ともに暗号化必須"

    - id: S011
      policy: "ログマスキング"
      description: "機密情報はログ出力時にマスク処理"

    - id: S012
      policy: "一時ファイルの削除"
      description: "タスク完了後は一時ファイルを確実に削除"

  # ---------------------------------------------------------------------------
  # 監査
  # ---------------------------------------------------------------------------
  audit:
    - id: S020
      policy: "全アクションのログ記録"
      description: "実行したすべてのアクションをログに記録"
      retention: "90 days"

    - id: S021
      policy: "変更の追跡"
      description: "ファイル変更はすべてバージョン管理"

    - id: S022
      policy: "異常検知時の報告"
      description: "異常を検知した場合は即座に報告"

# =============================================================================
# 違反時の対応
# =============================================================================

violation_handling:
  critical:
    action: "即時停止"
    notification: ["security_team", "admin"]
    investigation: "required"

  high:
    action: "一時停止・確認"
    notification: ["team_lead"]
    investigation: "recommended"

  medium:
    action: "警告・ログ記録"
    notification: ["assignee"]
    investigation: "optional"

  low:
    action: "ログ記録のみ"
    notification: []
    investigation: "none"
