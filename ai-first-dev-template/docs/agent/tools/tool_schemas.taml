# ツールスキーマ定義
# Format: TAML (Text-based Application Markup Language)

version: "1.0"
last_updated: "YYYY-MM-DD"

# =============================================================================
# ツールスキーマ
# =============================================================================

tools:

  # ---------------------------------------------------------------------------
  # code_generator
  # ---------------------------------------------------------------------------
  - id: code_generator
    name: "Code Generator"
    description: "要件に基づいてコードを生成するツール"

    input:
      type: object
      required: [requirement, language]
      properties:
        requirement:
          type: string
          description: "生成するコードの要件"
          max_length: 5000
        language:
          type: string
          enum: [python, javascript, typescript, go, java, rust]
          description: "プログラミング言語"
        framework:
          type: string
          description: "使用するフレームワーク"
        style_guide:
          type: string
          description: "適用するスタイルガイド"
        include_tests:
          type: boolean
          default: true
          description: "テストコードを含めるか"

    output:
      type: object
      properties:
        code:
          type: string
          description: "生成されたコード"
        tests:
          type: string
          description: "生成されたテストコード"
        files:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              content:
                type: string
        explanation:
          type: string
          description: "コードの説明"

    errors:
      - code: CG001
        condition: "要件が不明確"
        message: "要件の詳細化が必要です"
        action: "clarify_requirement"
      - code: CG002
        condition: "サポート外の言語"
        message: "指定された言語はサポートされていません"
        action: "reject"
      - code: CG003
        condition: "生成サイズ超過"
        message: "生成コードが制限を超えています"
        action: "split_generation"

  # ---------------------------------------------------------------------------
  # file_editor
  # ---------------------------------------------------------------------------
  - id: file_editor
    name: "File Editor"
    description: "ファイルを読み取り・編集するツール"

    input:
      type: object
      required: [file_path, operation]
      properties:
        file_path:
          type: string
          description: "対象ファイルパス（プロジェクトルートからの相対パス）"
          pattern: "^[^/].*"  # 絶対パス禁止
        operation:
          type: string
          enum: [read, write, append, delete]
          description: "操作種別"
        content:
          type: string
          description: "書き込み内容（write/appendの場合）"
        encoding:
          type: string
          default: "utf-8"
          description: "文字エンコーディング"

    output:
      type: object
      properties:
        success:
          type: boolean
        content:
          type: string
          description: "ファイル内容（readの場合）"
        lines_changed:
          type: integer
          description: "変更行数"
        backup_path:
          type: string
          description: "バックアップファイルパス"

    errors:
      - code: FE001
        condition: "ファイルが存在しない"
        message: "指定されたファイルが見つかりません"
        action: "create_or_abort"
      - code: FE002
        condition: "権限不足"
        message: "ファイルへのアクセス権限がありません"
        action: "escalate"
      - code: FE003
        condition: "プロジェクト外"
        message: "プロジェクト外のファイルは編集できません"
        action: "reject"

  # ---------------------------------------------------------------------------
  # test_runner
  # ---------------------------------------------------------------------------
  - id: test_runner
    name: "Test Runner"
    description: "テストを実行するツール"

    input:
      type: object
      properties:
        target:
          type: string
          description: "テスト対象（ファイル/ディレクトリ/パターン）"
          default: "."
        type:
          type: string
          enum: [unit, integration, e2e, all]
          default: "unit"
          description: "テスト種別"
        coverage:
          type: boolean
          default: true
          description: "カバレッジ計測"
        parallel:
          type: boolean
          default: true
          description: "並列実行"
        timeout:
          type: integer
          default: 600
          description: "タイムアウト（秒）"

    output:
      type: object
      properties:
        success:
          type: boolean
        total:
          type: integer
          description: "テスト総数"
        passed:
          type: integer
          description: "成功数"
        failed:
          type: integer
          description: "失敗数"
        skipped:
          type: integer
          description: "スキップ数"
        coverage:
          type: object
          properties:
            line:
              type: number
            branch:
              type: number
            function:
              type: number
        failures:
          type: array
          items:
            type: object
            properties:
              test_name:
                type: string
              error_message:
                type: string
              stack_trace:
                type: string
        duration:
          type: number
          description: "実行時間（秒）"

    errors:
      - code: TR001
        condition: "テストが見つからない"
        message: "実行可能なテストが見つかりません"
        action: "report"
      - code: TR002
        condition: "タイムアウト"
        message: "テスト実行がタイムアウトしました"
        action: "terminate_and_report"
      - code: TR003
        condition: "環境エラー"
        message: "テスト環境のセットアップに失敗しました"
        action: "escalate"

  # ---------------------------------------------------------------------------
  # git_client
  # ---------------------------------------------------------------------------
  - id: git_client
    name: "Git Client"
    description: "Git操作を行うツール"

    input:
      type: object
      required: [command]
      properties:
        command:
          type: string
          enum: [status, add, commit, push, pull, checkout, branch, log, diff]
          description: "Gitコマンド"
        args:
          type: array
          items:
            type: string
          description: "コマンド引数"
        message:
          type: string
          description: "コミットメッセージ（commitの場合）"
        branch:
          type: string
          description: "ブランチ名"

    output:
      type: object
      properties:
        success:
          type: boolean
        output:
          type: string
          description: "コマンド出力"
        commit_hash:
          type: string
          description: "コミットハッシュ（commitの場合）"
        changed_files:
          type: array
          items:
            type: string
          description: "変更ファイル一覧"

    errors:
      - code: GC001
        condition: "ブランチ禁止"
        message: "このブランチへの操作は禁止されています"
        action: "reject"
      - code: GC002
        condition: "コンフリクト"
        message: "マージコンフリクトが発生しました"
        action: "report_and_pause"
      - code: GC003
        condition: "認証エラー"
        message: "リモートへの認証に失敗しました"
        action: "escalate"

  # ---------------------------------------------------------------------------
  # security_scanner
  # ---------------------------------------------------------------------------
  - id: security_scanner
    name: "Security Scanner"
    description: "セキュリティスキャンを行うツール"

    input:
      type: object
      properties:
        target:
          type: string
          description: "スキャン対象"
          default: "."
        scan_type:
          type: array
          items:
            type: string
            enum: [sast, dependency, secrets, configuration]
          default: [sast, dependency, secrets]
          description: "スキャン種別"
        severity_threshold:
          type: string
          enum: [low, medium, high, critical]
          default: "medium"
          description: "報告する最低深刻度"

    output:
      type: object
      properties:
        success:
          type: boolean
        vulnerabilities:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              severity:
                type: string
              title:
                type: string
              description:
                type: string
              location:
                type: string
              recommendation:
                type: string
        summary:
          type: object
          properties:
            critical:
              type: integer
            high:
              type: integer
            medium:
              type: integer
            low:
              type: integer

    errors:
      - code: SS001
        condition: "スキャン失敗"
        message: "セキュリティスキャンに失敗しました"
        action: "retry_or_escalate"
      - code: SS002
        condition: "critical検出"
        message: "重大な脆弱性が検出されました"
        action: "block_and_escalate"

  # ---------------------------------------------------------------------------
  # notification_sender
  # ---------------------------------------------------------------------------
  - id: notification_sender
    name: "Notification Sender"
    description: "通知を送信するツール"

    input:
      type: object
      required: [channel, message]
      properties:
        channel:
          type: string
          enum: [slack, email, webhook]
          description: "通知チャンネル"
        target:
          type: string
          description: "送信先（チャンネル名/メールアドレス/URL）"
        message:
          type: string
          description: "メッセージ本文"
          max_length: 4000
        priority:
          type: string
          enum: [low, normal, high, urgent]
          default: "normal"
        attachments:
          type: array
          items:
            type: object
            properties:
              title:
                type: string
              content:
                type: string

    output:
      type: object
      properties:
        success:
          type: boolean
        message_id:
          type: string
        timestamp:
          type: string
          format: date-time

    errors:
      - code: NS001
        condition: "送信失敗"
        message: "通知の送信に失敗しました"
        action: "retry"
      - code: NS002
        condition: "チャンネル不許可"
        message: "このチャンネルへの送信は許可されていません"
        action: "reject"
